////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////

/////            Muon Studies for CSA14                     ////

/////        A. Calder√≥n (IFCA)   18 / 08 / 2014            ////

////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////



#pragma once

#include "PAF/computing/PAFChainItemSelector.h"

#include <TH1F.h>
#include <TMatrix.h>
#include <TH2F.h>
#include <TLorentzVector.h>
#include "Riostream.h"  


class BasicmuonAnalyzer: public PAFChainItemSelector{
  
 public:
  virtual ~BasicmuonAnalyzer() {}
  
  virtual void                Initialise();
  virtual void                InsideLoop();
  virtual void                Summary();
  
 protected:
  void                        GetAllMuons();
  void                        SetGenInfo();
  void                        GetMatching();
  bool                        passMediumID(int);
  bool                        passPFIso (int, string, float);
  float                       getPFRelIso (int, string);
  void                        DoRecount();

  // My Declarations:
  // Define global variables
  
 
  ///** GEN INFORMATION
  std::vector<TLorentzVector> G_GEN_PromptMuon_4vec;
  std::vector<TLorentzVector> G_GEN_Muon_4vec;
  
  //** MUONS
  std::vector<TLorentzVector> G_Muon_4vec;

  std::vector<bool>           G_MuonID_Tight;
  std::vector<bool>           G_MuonID_Medium;
  std::vector<bool>           G_MuonID_HWW;
  std::vector<bool>           G_MuonID_MediumHWW;
  std::vector<bool>           G_MuonID_GLBorTRKArb;
  std::vector<bool>           G_MuonID_Fiducial;
  
  std::vector<bool>           G_MuonISO03;
  std::vector<bool>           G_MuonISO03_dBeta;
  std::vector<bool>           G_MuonISO03_PFWeights;
  std::vector<bool>           G_MuonISO04;
  std::vector<bool>           G_MuonISO04_dBeta;
  std::vector<bool>           G_MuonISO04_PFWeights;

  std::vector<int>            G_Muon_Matching;
   
  bool                        G_isMuMu;
  bool                        G_isMuTau;
  bool                        G_isTauMu;
  bool                        G_isTauTau;
  bool                        G_PassGen;
  bool                        G_isNonPrompt;

  UInt_t                      G_RecoMuSize;
  UInt_t                      G_NPV;
   
  bool                        G_Debug_DefineAnalysisVariables;

  UInt_t                      GCount_AllEvents;
  UInt_t                      GCount_GenEvents;
  UInt_t                      GCount_Fiducial_AtLeast2;
  UInt_t                      GCount_Fiducial_2;
  UInt_t                      GCount_Fiducial_1st2nd;
  UInt_t                      GCount_Match_1st2nd;
  UInt_t                      GCount_NoMatch_1st2nd;
  UInt_t                      GCount_MatchTight_1st2nd;
  UInt_t                      GCount_MatchTightIso_1st2nd;
  UInt_t                      GCount_MatchTightIso_Only1st;
  UInt_t                      GCount_MatchTightIso_Only2nd;
  UInt_t                      GCount_MatchTightIso_None;
  UInt_t                      GCount_MatchTight_Only1st;
  UInt_t                      GCount_MatchTight_Only2nd;
  UInt_t                      GCount_MatchTight_None;
  UInt_t                      GCount_Tight_1st2nd;
  UInt_t                      GCount_TightIso_1st2nd;
  UInt_t                      GCount_TightIso_Only1st;
  UInt_t                      GCount_TightIso_Only2nd;
  UInt_t                      GCount_TightIso_None;
  UInt_t                      GCount_Tight_Only1st;
  UInt_t                      GCount_Tight_Only2nd;
  UInt_t                      GCount_Tight_None;
  UInt_t                      GCount_Fiducial_1st3rd;
  UInt_t                      GCount_Match_1st3rd;
  UInt_t                      GCount_NoMatch_1st3rd;
  UInt_t                      GCount_MatchTight_1st3rd;
  UInt_t                      GCount_MatchTightIso_1st3rd;
  UInt_t                      GCount_MatchTightIso_Only3rd;
  UInt_t                      GCount_MatchTight_Only3rd;
  UInt_t                      GCount_Tight_1st3rd;
  UInt_t                      GCount_TightIso_1st3rd;
  UInt_t                      GCount_TightIso_Only3rd;
  UInt_t                      GCount_Tight_Only3rd;
  UInt_t                      GCount_Fiducial_1stOther;
  UInt_t                      GCount_Fiducial_MoreThan2;
  UInt_t                      GCount_Match_MoreThan2_OK;
  UInt_t                      GCount_Match_MoreThan2;
  UInt_t                      GCount_NoMatch_MoreThan2;
  UInt_t                      GCount_Fiducial_3;
  UInt_t                      GCount_Fiducial_MoreThan3;
  UInt_t                      GCount_Fiducial_Only1st;
  UInt_t                      GCount_Fiducial_None;

 
   //* Histograms 
  TH1F                        *h_N_PV;
  TH1F                        *h_N_PV2;
  TH1F                        *h_N_PV3;
  
  
  // * Input parameters
  TString                     _Signal;       // Type of Signal
  int                         _NEvents;      // Total number of events in the sample before skim
  float                       _Luminosity;   // Total luminosity
  float                       _XSection;     // Process cross section
  bool                        _IsDATA;       // True if is Data, False in case MC
  int                         _WhichRun;     // 1 in case of RunI samples. 2 In case of RunII samples.;
  // * Weights
  float                       _factN; // Normalization factor

 public:  
 BasicmuonAnalyzer() : 
     PAFChainItemSelector(),
     G_isMuMu(),
     G_isMuTau(),
     G_isTauMu(),
     G_isTauTau(),
     G_PassGen(),
     G_isNonPrompt(),
     G_RecoMuSize(),
     G_NPV(),
     G_Debug_DefineAnalysisVariables(),
       
     GCount_AllEvents(),
     GCount_GenEvents(),
     GCount_Fiducial_AtLeast2(),
     GCount_Fiducial_2(),
     GCount_Fiducial_1st2nd(),
     GCount_Match_1st2nd(),
     GCount_NoMatch_1st2nd(),
     GCount_MatchTight_1st2nd(),
     GCount_MatchTightIso_1st2nd(),
     GCount_MatchTightIso_Only1st(),
     GCount_MatchTightIso_Only2nd(),
     GCount_MatchTightIso_None(),
     GCount_MatchTight_Only1st(),
     GCount_MatchTight_Only2nd(),
     GCount_MatchTight_None(),
     GCount_Tight_1st2nd(),
     GCount_TightIso_1st2nd(),
     GCount_TightIso_Only1st(),
     GCount_TightIso_Only2nd(),
     GCount_TightIso_None(),
     GCount_Tight_Only1st(),
     GCount_Tight_Only2nd(),
     GCount_Tight_None(),
     GCount_Fiducial_1st3rd(),
     GCount_Match_1st3rd(),
     GCount_NoMatch_1st3rd(),
     GCount_MatchTight_1st3rd(),
     GCount_MatchTightIso_1st3rd(),
     GCount_MatchTightIso_Only3rd(),
     GCount_MatchTight_Only3rd(),
     GCount_Tight_1st3rd(),
     GCount_TightIso_1st3rd(),
     GCount_TightIso_Only3rd(),
     GCount_Tight_Only3rd(),
     GCount_Fiducial_1stOther(),
     GCount_Fiducial_MoreThan2(),
     GCount_Match_MoreThan2_OK(),
     GCount_Match_MoreThan2(),
     GCount_NoMatch_MoreThan2(),
     GCount_Fiducial_3(),
     GCount_Fiducial_MoreThan3(),
     GCount_Fiducial_Only1st(),
     GCount_Fiducial_None(),
     
     h_N_PV(),
     h_N_PV2(),
     h_N_PV3(),
     
     _Signal(),
     _NEvents(),
     _Luminosity(),
     _XSection(),
     _IsDATA(),
     _WhichRun(),
     _factN()
       { }

   ClassDef(BasicmuonAnalyzer,0);
};
